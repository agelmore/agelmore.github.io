---
layout: post
title:  "Digital normalization"
date:   2014-11-18
comments: true
---

Digital normalization is a method created by Titas Brown which will remove highly redundant sequences to decrease the file size, remove errors, and make it easier to assemble using a single-genome assembler like velvet. I will use this method before assembling with velvet and Ray because my data set is too big to assemble with the full dataset.

There is pretty good documentation on the [read the docs](http://khmer.readthedocs.org/en/v0.5/scripts.html). I had trouble getting khmer to work with the permissions that I have on axiom, so I followed the directions to create a khmer environment. I made the alias in my bash_profile so that khmerEnv will activate the environment. This works when running jobs in the queue as well.

```
alias khmerEnv="source /mnt/EXT/Schloss-data/amanda/Fuso/khmer/khmerEnv/bin/activate"
```

I have two scripts that I can use to interleave reads, one from khmer (interleave-reads.py) and one from velvet (shuffleSequences_fasta). I usually use the one from velvet, but the khmer digital normalization scripts couldn't recognize that file as paired reads, so there must be a difference in formatting. Since I had already interleaved using the velvet script, I first ran khmer without the paired option. This means that it may throw out one read and not it's pair, so I can't use linkage data later to assemble.

{% highlight bash %}

perl /mnt/EXT/Schloss-data/amanda/velvet/velvet_1.2.10/contrib/shuffleSequences_fasta/shuffleSequences_fasta.pl All_R1.fa All_R2.fa All.fa
khmerEnv #to activate khmer environment
python2.7 /mnt/EXT/Schloss-data/amanda/Fuso/khmer/khmerEnv/bin/normalize-by-median.py -k 41 All.fa -o normalized

{% endhighlight %}

Output:

{% highlight bash %}

DONE with All.fa; kept 190653 of 1488000000 or  0%
output in All.fa.keep
fp rate estimated to be 1.000

{% endhighlight %}

Wow, it cut out almost all the reads. This must be because I didn't specify a coverage cutoff parameter. I ran again with this included:

{% highlight bash %}

khmerEnv; python2.7 /mnt/EXT/Schloss-data/amanda/Fuso/khmer/khmerEnv/bin/normalize-by-median.py -C 20 -k 20 All.fa -o normalized

{% endhighlight %}

###What's next
* Velvet assembly
* Redo Ray assembly with normalized reads
* Do khmer again with paired option (interleave-reads.py)

